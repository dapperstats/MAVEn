# load the raw MAVEn dataset
maven_raw <- read_maven(maven_file = "./maven_output.csv", baseline = T)
plot_maven_overview(maven_raw)
# load the modified MAVEn dataset
maven <- read_maven(maven_file = "./maven_output.csv", baseline = F)
# assign a cycle number to the dataset
maven <- cycle_number(maven)
metabolism_summary_cycle
maven %>% group_by(Chamber, cycle) %>% slice(c(1,n()))
maven %>% group_by(Chamber, cycle) %>% slice(c(1,n())) %>% select(Seconds, Chamber, cycle)
metabolism_summary_cycle
head(act)
interval = 300
met <- metabolism_summary_cycle %>%
mutate(act_start = median_time - interval,
act_end = median_time + interval)
met
interval = 10
met <- metabolism_summary_cycle %>%
mutate(act_start = median_time - interval,
act_end = median_time + interval)
met
90
interval = 90
met <- metabolism_summary_cycle %>%
mutate(act_start = median_time - interval,
act_end = median_time + interval)
met
interval = 75
met <- metabolism_summary_cycle %>%
mutate(act_start = median_time - interval,
act_end = median_time + interval)
met
act <- maven_raw %>%
select(Seconds:BP_kPa, c_FRC_mlmin:CO2_mlmin, cycle, Act_1:Act_16) %>%
pivot_longer(cols = Act_1:Act_16, names_to = "parameter", values_to = "result")
act <- maven_raw %>%
select(Seconds:BP_kPa, c_FRC_mlmin:CO2_mlmin, Act_1:Act_16) %>%
pivot_longer(cols = Act_1:Act_16, names_to = "parameter", values_to = "result")
head(act)
head(met)
interval = 60
met <- metabolism_summary_cycle %>%
mutate(act_start = median_time - interval,
act_end = median_time + interval)
act <- maven %>%
select(Seconds:BP_kPa, cycle, c_FRC_mlmin:CO2_mlmin, Act_1:Act_16) %>%
pivot_longer(cols = Act_1:Act_16, names_to = "parameter", values_to = "result") %>%
left_join(met, by = c("Chamber", "cycle"))
act
act <- maven %>%
select(Seconds:BP_kPa, cycle, c_FRC_mlmin:CO2_mlmin, Act_1:Act_16) %>%
pivot_longer(cols = Act_1:Act_16, names_to = "parameter", values_to = "result") %>%
left_join(met, by = c("Chamber", "cycle")) %>%
group_by(Chamber, cycle) %>%
filter(Seconds > act_start & Seconds < act_end)
act
met
act <- maven %>%
select(Seconds:BP_kPa, cycle, c_FRC_mlmin:CO2_mlmin, Act_1:Act_16) %>%
pivot_longer(cols = Act_1:Act_16, names_to = "parameter", values_to = "result") %>%
left_join(met, by = c("Chamber", "cycle")) %>%
filter(Seconds > act_start & Seconds < act_end)
act <- maven %>%
select(Seconds:BP_kPa, cycle, c_FRC_mlmin:CO2_mlmin, Act_1:Act_16) %>%
pivot_longer(cols = Act_1:Act_16, names_to = "parameter", values_to = "result") %>%
left_join(met, by = c("Chamber", "cycle")) %>%
group_by(Chamber, cycle) %>%
filter(Seconds > median_time - interval & Seconds < median_time + interval)
warnings()
# assign a cycle number to the dataset
maven <- cycle_number(maven)
# assign a cycle number to the dataset
maven <- cycle_number(maven)
# load the modified MAVEn dataset
maven <- read_maven(maven_file = "./maven_output.csv", baseline = F)
# assign a cycle number to the dataset
maven <- cycle_number(maven)
met <- metabolism_summary_cycle %>%
mutate(act_start = median_time - interval,
act_end = median_time + interval)
met
act <- maven %>%
select(Seconds:BP_kPa, cycle, c_FRC_mlmin:CO2_mlmin, Act_1:Act_16)
act <- maven %>%
select(Seconds:BP_kPa, cycle, c_FRC_mlmin:CO2_mlmin, Act_1:Act_16) %>%
pivot_longer(cols = Act_1:Act_16, names_to = "parameter", values_to = "result")
act <- maven %>%
select(Seconds:BP_kPa, cycle, c_FRC_mlmin:CO2_mlmin, Act_1:Act_16) %>%
pivot_longer(cols = Act_1:Act_16, names_to = "parameter", values_to = "result") %>%
left_join(met, by = c("Chamber", "cycle"))
act <- maven %>%
select(Seconds:BP_kPa, cycle, c_FRC_mlmin:CO2_mlmin, Act_1:Act_16) %>%
pivot_longer(cols = Act_1:Act_16, names_to = "parameter", values_to = "result") %>%
left_join(met, by = c("Chamber", "cycle")) %>%
group_by(Chamber, cycle)
act <- maven %>%
select(Seconds:BP_kPa, cycle, c_FRC_mlmin:CO2_mlmin, Act_1:Act_16) %>%
pivot_longer(cols = Act_1:Act_16, names_to = "parameter", values_to = "result") %>%
left_join(met, by = c("Chamber", "cycle")) %>%
group_by(Chamber, cycle) %>%
filter(Seconds > median_time - interval)
act <- maven %>%
select(Seconds:BP_kPa, cycle, c_FRC_mlmin:CO2_mlmin, Act_1:Act_16) %>%
pivot_longer(cols = Act_1:Act_16, names_to = "parameter", values_to = "result") %>%
left_join(met, by = c("Chamber", "cycle")) %>%
group_by(Chamber, cycle) %>%
filter(Seconds > median_time - interval & Seconds < median_time + interval)
interval = 10
act <- maven %>%
select(Seconds:BP_kPa, cycle, c_FRC_mlmin:CO2_mlmin, Act_1:Act_16) %>%
pivot_longer(cols = Act_1:Act_16, names_to = "parameter", values_to = "result") %>%
left_join(met, by = c("Chamber", "cycle")) %>%
group_by(Chamber, cycle) %>%
filter(Seconds > median_time - interval & Seconds < median_time + interval)
head(act)
interval = 45
act <- maven %>%
select(Seconds:BP_kPa, cycle, c_FRC_mlmin:CO2_mlmin, Act_1:Act_16) %>%
pivot_longer(cols = Act_1:Act_16, names_to = "parameter", values_to = "result") %>%
left_join(met, by = c("Chamber", "cycle")) %>%
group_by(Chamber, cycle) %>%
filter(Seconds > median_time - interval & Seconds < median_time + interval)
heac(act)
head(act)
act <- maven %>%
select(Seconds:BP_kPa, cycle, c_FRC_mlmin:CO2_mlmin, Act_1:Act_16) %>%
pivot_longer(cols = Act_1:Act_16, names_to = "parameter", values_to = "result") %>%
left_join(met, by = c("Chamber", "cycle")) %>%
group_by(Chamber, cycle) %>%
filter(Seconds > median_time - interval & Seconds < median_time + interval) %>%
group_by(Chamber, cycle) %>%
mutate(measurement_number = Seconds - min(Seconds) + 1)
ggplot(act, aes(measurement_number, result)) +
geom_point() + facet_wrap(~Chamber)
ggplot(act, aes(Seconds, result)) +
geom_point() + facet_wrap(~Chamber)
ggplot(act, aes(measurement_number, result)) +
geom_point() + facet_wrap(~Chamber)
# Creates a dataframe for the fly activity
extract_activity <- function(maven, metabolism_summary_cycle, interval = "", threshold = ""){
met <- metabolism_summary_cycle %>%
mutate(act_start = median_time - interval,
act_end = median_time + interval)
act <- maven %>%
select(Seconds:BP_kPa, cycle, c_FRC_mlmin:CO2_mlmin, Act_1:Act_16) %>%
pivot_longer(cols = Act_1:Act_16, names_to = "parameter", values_to = "result") %>%
left_join(met, by = c("Chamber", "cycle")) %>%
group_by(Chamber, cycle) %>%
filter(Seconds > median_time - interval & Seconds < median_time + interval) %>%
group_by(Chamber, cycle) %>%
mutate(measurement_number = Seconds - min(Seconds) + 1) %>%
filter(result > threshold)
return(act)
}
extract_activity(maven, metabolism_summary_cycle, interval= 30, threshold = 0.1)
test.out <- extract_activity(maven, metabolism_summary_cycle, interval= 30, threshold = 0.1)
ggplot(test.out, aes(measurement_number, result)) +
geom_point() + facet_wrap(~Chamber)
extract_activity <- extract_activity(maven, metabolism_summary_cycle, interval= 30, threshold = 0.1)
act_summary <- extract_activity %>%
group_by(Chamber, cycle) %>%
summarize(mean_activity = mean(result),
median_activity = median(result))
act_summary
ggplot(test.out, aes(measurement_number, result, col = cycle)) +
geom_point() + facet_wrap(~Chamber)
threshold = 0
extract_activity <- extract_activity(maven, metabolism_summary_cycle, interval= 30, threshold = 0.1)
# Creates a dataframe for the fly activity
extract_activity <- function(maven, metabolism_summary_cycle, interval = "", threshold = ""){
met <- metabolism_summary_cycle %>%
mutate(act_start = median_time - interval,
act_end = median_time + interval)
act <- maven %>%
select(Seconds:BP_kPa, cycle, c_FRC_mlmin:CO2_mlmin, Act_1:Act_16) %>%
pivot_longer(cols = Act_1:Act_16, names_to = "parameter", values_to = "result") %>%
left_join(met, by = c("Chamber", "cycle")) %>%
group_by(Chamber, cycle) %>%
filter(Seconds > median_time - interval & Seconds < median_time + interval) %>%
group_by(Chamber, cycle) %>%
mutate(measurement_number = Seconds - min(Seconds) + 1) %>%
filter(result > threshold)
return(act)
}
extract_activity <- extract_activity(maven, metabolism_summary_cycle, interval= 30, threshold = 0.1)
# extract activity data
extract_activity <- extract_activity(maven, metabolism_summary_cycle, interval= 30, threshold = 0.0)
# Creates a dataframe for the fly activity
extract_activity <- function(maven, metabolism_summary_cycle, interval = "", threshold = ""){
met <- metabolism_summary_cycle %>%
mutate(act_start = median_time - interval,
act_end = median_time + interval)
act <- maven %>%
select(Seconds:BP_kPa, cycle, c_FRC_mlmin:CO2_mlmin, Act_1:Act_16) %>%
pivot_longer(cols = Act_1:Act_16, names_to = "parameter", values_to = "result") %>%
left_join(met, by = c("Chamber", "cycle")) %>%
group_by(Chamber, cycle) %>%
filter(Seconds > median_time - interval & Seconds < median_time + interval) %>%
group_by(Chamber, cycle) %>%
mutate(measurement_number = Seconds - min(Seconds) + 1) %>%
filter(result > threshold)
return(act)
}
# extract activity data
fly_activity<- extract_activity(maven, metabolism_summary_cycle, interval= 30, threshold = 0.0)
summarize_metabolism <- function(fly_metabolism, type = ""){
met_summary <- fly_metabolism %>%
group_by(Chamber, cycle) %>%
summarize(median_co2_ul.h = co2_convertion_median(result),
median_time = median(Seconds),
median_temp = median(TempC))
if(type == "by_chamber"){
met_summary <- met_summary %>%
group_by(Chamber) %>%
summarize(mean = mean(median_co2_ul.h),
sd = sd(median_co2_ul.h),
n = round(n_cycles),
sem = sem(median_co2_ul.h, n),
lower.ci = lower.ci(median_co2_ul.h, n),
upper.ci = upper.ci(median_co2_ul.h, n))
}
return(met_summary)
}
summarize_activity <- function(fly_activity, type = ""){
act_summary <- extract_activity %>%
group_by(Chamber, cycle) %>%
summarize(mean_activity = mean(result),
median_activity = median(result))
if(type = "by_chamber"){
act_summary <- act_summary %>%
group_by(Chamber) %>%
summarize(mean = mean(mean_activity),
sd = sd(mean_activity),
n = round(n_cycles),
sem = sem(mean_activity, n),
lower.ci = lower.ci(mean_activity, n),
upper.ci = upper.ci(mean_activity, n))
}
return(act_summary)
}
summarize_activity <- function(fly_activity, type = ""){
act_summary <- extract_activity %>%
group_by(Chamber, cycle) %>%
summarize(mean_activity = mean(result),
median_activity = median(result))
if(type == "by_chamber"){
act_summary <- act_summary %>%
group_by(Chamber) %>%
summarize(mean = mean(mean_activity),
sd = sd(mean_activity),
n = round(n_cycles),
sem = sem(mean_activity, n),
lower.ci = lower.ci(mean_activity, n),
upper.ci = upper.ci(mean_activity, n))
}
return(act_summary)
}
ggplot(fly_activity, aes(measurement_number, result, col = cycle)) +
geom_point() + facet_wrap(~Chamber)
# extract activity data
fly_activity<- extract_activity(maven, metabolism_summary_cycle, interval= 30, threshold = 0.0)
ggplot(fly_activity, aes(measurement_number, result, col = cycle)) +
geom_point() + facet_wrap(~Chamber)
# extract activity data
fly_activity<- extract_activity(maven, metabolism_summary_cycle, interval= 60, threshold = 0.0)
ggplot(fly_activity, aes(measurement_number, result, col = cycle)) +
geom_point() + facet_wrap(~Chamber)
# Creates a dataframe for the fly activity
extract_activity <- function(maven, metabolism_summary_cycle, interval = "", threshold = ""){
met <- metabolism_summary_cycle %>%
mutate(act_start = median_time - interval,
act_end = median_time + interval)
act <- maven %>%
select(Seconds:BP_kPa, cycle, c_FRC_mlmin:CO2_mlmin, Act_1:Act_16) %>%
pivot_longer(cols = Act_1:Act_16, names_to = "parameter", values_to = "result") %>%
left_join(met, by = c("Chamber", "cycle")) %>%
group_by(Chamber, cycle) %>%
filter(Seconds > median_time - interval & Seconds < median_time + interval) %>%
group_by(Chamber, cycle) %>%
mutate(measurement_number = Seconds - min(Seconds) + 1) %>%
filter(result >= threshold)
return(act)
}
# extract activity data
fly_activity<- extract_activity(maven, metabolism_summary_cycle, interval= 60, threshold = 0.01)
ggplot(fly_activity, aes(measurement_number, result, col = cycle)) +
geom_point() + facet_wrap(~Chamber)
activity_summary_cycle <-summarize_activity(fly_activity, type = "by_cycle")
summarize_activity <- function(fly_activity, type = ""){
act_summary <- fly_activity %>%
group_by(Chamber, cycle) %>%
summarize(mean_activity = mean(result),
median_activity = median(result))
if(type == "by_chamber"){
act_summary <- act_summary %>%
group_by(Chamber) %>%
summarize(mean = mean(mean_activity),
sd = sd(mean_activity),
n = round(n_cycles),
sem = sem(mean_activity, n),
lower.ci = lower.ci(mean_activity, n),
upper.ci = upper.ci(mean_activity, n))
}
return(act_summary)
}
activity_summary_cycle <-summarize_activity(fly_activity, type = "by_cycle")
activity_summary_cycle
summarize_activity <- function(fly_activity, type = ""){
act_summary <- fly_activity %>%
group_by(Chamber, cycle) %>%
summarize(mean_activity = mean(result),
median_activity = median(result)) %>%
mutate(activity_state = ifelse(mean_activity >= activity_threshold, "Active", "Inactive"))
if(type == "by_chamber"){
act_summary <- act_summary %>%
group_by(Chamber) %>%
summarize(mean = mean(mean_activity),
sd = sd(mean_activity),
n = round(n_cycles),
sem = sem(mean_activity, n),
lower.ci = lower.ci(mean_activity, n),
upper.ci = upper.ci(mean_activity, n))
}
return(act_summary)
}
activity_summary_cycle <-summarize_activity(fly_activity, type = "by_cycle")
summarize_activity <- function(fly_activity, type = "", activity_threhold = "0.5"){
act_summary <- fly_activity %>%
group_by(Chamber, cycle) %>%
summarize(mean_activity = mean(result),
median_activity = median(result)) %>%
mutate(activity_state = ifelse(mean_activity >= activity_threshold, "Active", "Inactive"))
if(type == "by_chamber"){
act_summary <- act_summary %>%
group_by(Chamber) %>%
summarize(mean = mean(mean_activity),
sd = sd(mean_activity),
n = round(n_cycles),
sem = sem(mean_activity, n),
lower.ci = lower.ci(mean_activity, n),
upper.ci = upper.ci(mean_activity, n))
}
return(act_summary)
}
activity_summary_cycle <-summarize_activity(fly_activity, type = "by_cycle")
summarize_activity <- function(fly_activity, type = "", activity_threshold = "0.5"){
act_summary <- fly_activity %>%
group_by(Chamber, cycle) %>%
summarize(mean_activity = mean(result),
median_activity = median(result)) %>%
mutate(activity_state = ifelse(mean_activity >= activity_threshold, "Active", "Inactive"))
if(type == "by_chamber"){
act_summary <- act_summary %>%
group_by(Chamber) %>%
summarize(mean = mean(mean_activity),
sd = sd(mean_activity),
n = round(n_cycles),
sem = sem(mean_activity, n),
lower.ci = lower.ci(mean_activity, n),
upper.ci = upper.ci(mean_activity, n))
}
return(act_summary)
}
activity_summary_cycle <-summarize_activity(fly_activity, type = "by_cycle")
activity_summary_cycle
activity_summary_cycle <- summarize_activity(fly_activity, type = "by_chamber")
activity_summary_cycle
activity_summary_chamber <- summarize_activity(fly_activity, type = "by_chamber")
activity_summary_cycle <- summarize_activity(fly_activity, type = "by_cycle")
activity_summary_cycle
# generate summary table by cycle
metabolism_summary_cycle <- summarize_metabolism(fly_metabolism, type = "by_cycle")
metabolism_summary_cycle
metabolism_summary_cycle %>% left_join(activity_summary_cycle, by = c("Chamber","cycle"))
create_data_table <- function(metabolism_summary_cycle, activity_summary_cycle){
metabolism_summary_cycle %>%
left_join(activity_summary_cycle, by = c("Chamber","cycle"))
}
create_data_table
create_data_table()
create_data_table(metabolism_summary_cycle, activity_summary_cycle)
test.out <- create_data_table(metabolism_summary_cycle, activity_summary_cycle)
ggplot(test.out, aes(x = activity_stat, y = median_co2_ul.h)) +
geom_boxplot()
ggplot(test.out, aes(x = activity_state, y = median_co2_ul.h)) +
geom_boxplot()
View(test.out)
summarize_activity <- function(fly_activity, type = "", activity_threshold = "0.5"){
act_summary <- fly_activity %>%
group_by(Chamber, cycle) %>%
summarize(mean_activity = mean(result, na.rm = T),
median_activity = median(result, na.rm = T)) %>%
mutate(activity_state = ifelse(mean_activity >= activity_threshold, "Active", "Inactive"))
if(type == "by_chamber"){
act_summary <- act_summary %>%
group_by(Chamber) %>%
summarize(mean = mean(mean_activity, na.rm = T),
sd = sd(mean_activity, na.rm = T),
n = round(n_cycles),
sem = sem(mean_activity, n),
lower.ci = lower.ci(mean_activity, n),
upper.ci = upper.ci(mean_activity, n))
}
return(act_summary)
}
activity_summary_cycle <- summarize_activity(fly_activity, type = "by_cycle")
test.out <- create_data_table(metabolism_summary_cycle, activity_summary_cycle)
summarize_activity <- function(fly_activity, type = "", activity_threshold = "0.5"){
act_summary <- fly_activity %>%
group_by(Chamber, cycle) %>%
summarize(mean_activity = mean(result, na.rm = T),
median_activity = median(result, na.rm = T)) %>%
mutate(is.na(mean_activity) <- 0,
activity_state = ifelse(mean_activity >= activity_threshold, "Active", "Inactive"))
if(type == "by_chamber"){
act_summary <- act_summary %>%
group_by(Chamber) %>%
summarize(mean = mean(mean_activity, na.rm = T),
sd = sd(mean_activity, na.rm = T),
n = round(n_cycles),
sem = sem(mean_activity, n),
lower.ci = lower.ci(mean_activity, n),
upper.ci = upper.ci(mean_activity, n))
}
return(act_summary)
}
activity_summary_cycle <- summarize_activity(fly_activity, type = "by_cycle")
act_summary <- fly_activity %>%
group_by(Chamber, cycle) %>%
summarize(mean_activity = mean(result, na.rm = T),
median_activity = median(result, na.rm = T)) %>%
mutate(is.na(mean_activity) <- 0,
activity_state = ifelse(mean_activity >= activity_threshold, "Active", "Inactive"))
activity_threshold = "0.5"
act_summary <- fly_activity %>%
group_by(Chamber, cycle) %>%
summarize(mean_activity = mean(result, na.rm = T),
median_activity = median(result, na.rm = T)) %>%
mutate(is.na(mean_activity) <- 0)
act_summary
View(act_summary)
summarize_activity <- function(fly_activity, type = "", activity_threshold = "0.5"){
act_summary <- fly_activity %>%
group_by(Chamber, cycle) %>%
summarize(mean_activity = mean(result, na.rm = T),
median_activity = median(result, na.rm = T)) %>%
mutate(mean_activity = replace_na(mean_activity, 0),
activity_state = ifelse(mean_activity >= activity_threshold, "Active", "Inactive"))
if(type == "by_chamber"){
act_summary <- act_summary %>%
group_by(Chamber) %>%
summarize(mean = mean(mean_activity, na.rm = T),
sd = sd(mean_activity, na.rm = T),
n = round(n_cycles),
sem = sem(mean_activity, n),
lower.ci = lower.ci(mean_activity, n),
upper.ci = upper.ci(mean_activity, n))
}
return(act_summary)
}
activity_summary_cycle <- summarize_activity(fly_activity, type = "by_cycle")
test.out <- create_data_table(metabolism_summary_cycle, activity_summary_cycle)
test.out
act_summary <- fly_activity %>%
group_by(Chamber, cycle) %>%
summarize(mean_activity = mean(result, na.rm = T),
median_activity = median(result, na.rm = T))
summarize_activity <- function(fly_activity, type = "", activity_threshold = "0.5"){
act_summary <- fly_activity %>%
group_by(Chamber, cycle) %>%
summarize(mean_activity = mean(result, na.rm = T),
median_activity = median(result, na.rm = T)) %>%
mutate(activity_state = ifelse(mean_activity >= activity_threshold, "Active", "Inactive"))
if(type == "by_chamber"){
act_summary <- act_summary %>%
group_by(Chamber) %>%
summarize(mean = mean(mean_activity, na.rm = T),
sd = sd(mean_activity, na.rm = T),
n = round(n_cycles),
sem = sem(mean_activity, n),
lower.ci = lower.ci(mean_activity, n),
upper.ci = upper.ci(mean_activity, n))
}
return(act_summary)
}
test.out <- create_data_table(metabolism_summary_cycle, activity_summary_cycle)
test.out <- create_data_table(metabolism_summary_cycle, activity_summary_cycle) %>%
mutate(mean_activity = replace_na(mean_activity,0),
activity_state = ifelse(mean_activity >= activity_threshold, "Active", "Inactive"))
ggplot(test.out, aes(x = activity_state, y = median_co2_ul.h)) +
geom_boxplot()
ggplot(test.out, aes(x = activity_state, y = median_co2_ul.h)) +
geom_boxplot() + geom_points()
ggplot(test.out, aes(x = activity_state, y = median_co2_ul.h)) +
geom_boxplot() + geom_point()
ggplot(test.out, aes(x = activity_state, y = median_co2_ul.h)) +
geom_boxplot() + geom_point(position = position_dodge(width = 2))
ggplot(test.out, aes(x = activity_state, y = median_co2_ul.h)) +
geom_boxplot() + geom_point(position = position_jitter(width = .2))
ggplot(fly_activity, aes(measurement_number, result, col = cycle)) +
geom_point() + facet_wrap(~Chamber)
code <- sapply(list.files(file.path(".", "code"), full.names = TRUE), source)
# load the raw MAVEn dataset with baseline information
maven_raw <- read_maven(maven_file = "./maven_output.csv", baseline = T)
plot_maven_overview(maven_raw)
# load the modified MAVEn dataset without baseline for workflow processing
maven <- read_maven(maven_file = "./maven_output.csv", baseline = F)
head(maven)
# assign a cycle number to the dataset
maven <- cycle_number(maven)
maven
